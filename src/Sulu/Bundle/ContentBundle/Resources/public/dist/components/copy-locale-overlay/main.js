define(function(){"use strict";var a={},b={copyFrom:"content.contents.settings.copy-locales.copy-from",target:"content.contents.settings.copy-locales.target",info:"content.contents.settings.copy-locales.info",title:"content.contents.settings.copy-locales.title",ok:"content.contents.settings.copy-locales.ok",defaultLabel:"content.contents.settings.copy-locales.default-label",currentLanguage:"content.contents.settings.copy-locales.current-language"},c={copyLocales:function(a){var b=['<div class="copy-locales-overlay-content">',"   <label>",d.call(this,"copyFrom"),"   </label>",'   <div class="grid m-top-10">','       <div class="grid-row">','       <div id="copy-locales-select" class="grid-col-6"/>',"   </div>","</div>",'<h2 class="divider m-top-20">',d.call(this,"target"),"</h2>",'<p class="info">',"   * ",d.call(this,"info"),"</p>",'<div class="copy-locales-to-container m-bottom-20 grid">'],e=0;return this.sandbox.util.foreach(this.localizations,function(d){e%2===0&&b.push((e>0?"</div>":"")+'<div class="grid-row">'),b.push(c.copyLocalesCheckbox.call(this,d.title,a)),e++}.bind(this)),b.push("</div>"),b.push("</div>"),b.join("")},copyLocalesCheckbox:function(a,b){var c,d=[];for(var e in this.data.concreteLanguages)this.data.concreteLanguages.hasOwnProperty(e)&&d.push(this.data.concreteLanguages[e]);return c=a===this.options.language&&d.indexOf(a)>=0,['<div class="grid-col-3">','   <div class="custom-checkbox">','       <input type="checkbox"','              id="copy-locales-to-',a,'"','              name="copy-locales-to" class="form-element" value="',a,'"',c?' disabled="disabled"':"","/>",'       <span class="icon"></span>',"   </div>",'   <label for="copy-locales-to-',a,'" class="',c?"disabled":"",'">',a,d.indexOf(a)<0?" *":"","   </label>","</div>"].join("")}},d=function(b){return this.sandbox.translate(a[b])},e=function(a,b,c,d,e){var f=this.getCopyLocaleUrl(a,b,c.join(","));this.sandbox.util.save(f,"POST",{}).then(function(a){d&&"function"==typeof d&&d(a)}.bind(this)).fail(function(a,b,c){e&&"function"==typeof e&&e(c)}.bind(this))},f=function(a){var b=this.sandbox.dom.data("#copy-locales-select","selection"),c=this.sandbox.dom.find('.copy-locales-to-container input:checked:not(input[disabled="disabled"])'),d=[];return this.sandbox.util.foreach(c,function(a){d.push(this.sandbox.dom.val(a))}.bind(this)),b&&0!==b.length&&0!==d.length?(this.sandbox.off("husky.select.copy-locale-to.deselected.item",i.bind(this)),this.sandbox.off("husky.select.copy-locale-to.selected.item",j.bind(this)),e.call(this,this.data.id,b[0],d),void a.resolve(d)):!1},g=function(a,b){this.sandbox.start([{name:"overlay@husky",options:{openOnStart:!0,removeOnClose:!0,el:a,container:this.$el,instanceName:"copy-locales",skin:"medium",slides:[{title:d.call(this,"title"),data:c.copyLocales.call(this,this.data),buttons:[{type:"cancel",align:"left"},{type:"ok",text:d.call(this,"ok"),align:"right"}],okCallback:function(){f.call(this,b)}.bind(this)}]}}])},h=function(a){this.sandbox.start([{name:"select@husky",options:{el:"#copy-locales-select",instanceName:"copy-locale-to",defaultLabel:d.call(this,"defaultLabel"),preSelectedElements:[this.options.language],data:a}}])},i=function(a){var b="copy-locales-to-"+a;this.sandbox.dom.prop("#"+b,"disabled",""),this.sandbox.dom.removeClass('label[for="'+b+'"]',"disabled")},j=function(a){var b="copy-locales-to-"+a;this.sandbox.dom.prop("#"+b,"disabled","disabled"),this.sandbox.dom.addClass('label[for="'+b+'"]',"disabled")};return{copyLocale:function(a,b,c,d,f){e.call(this,a,b,c,d,f)},startCopyLocalesOverlay:function(c){a=this.sandbox.util.extend(!0,{},b,c);var e=this.sandbox.data.deferred(),f=this.sandbox.dom.createElement('<div class="overlay-container"/>'),k=[],l=d.call(this,"currentLanguage");return this.sandbox.dom.append(this.$el,f),this.sandbox.util.foreach(this.data.concreteLanguages,function(a){k.push({id:a,name:a+(a===this.options.language?" ("+l+")":"")})}.bind(this)),this.sandbox.on("husky.select.copy-locale-to.deselected.item",i.bind(this)),this.sandbox.on("husky.select.copy-locale-to.selected.item",j.bind(this)),g.call(this,f,e),h.call(this,k),e.promise()}}});